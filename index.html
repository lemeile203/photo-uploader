<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì‹¤ì²œ ëª©í‘œ ì •í•˜ê¸°</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- (ì„ íƒ) CropperJSê°€ í•„ìš” ì—†ë‹¤ë©´ ì•„ë˜ ë‘ ì¤„ì€ ì œê±°í•´ë„ ë©ë‹ˆë‹¤ -->
  <script src="https://unpkg.com/cropperjs"></script>
  <link rel="stylesheet" href="https://unpkg.com/cropperjs/dist/cropper.min.css" />

  <script src="https://cdn.jsdelivr.net/npm/heic2any/dist/heic2any.min.js"></script>
  <style>
    :root {
      --container-max: 300px;
    }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", Arial, sans-serif;
      background-color: #f4f4f4;
      text-align: center;
      padding: 20px;
    }
    h2 {
      color: #333;
      font-size: 1.2rem;
      margin-bottom: 1rem;
      line-height: 1.4;
    }
    #options {
      text-align: left;
      margin: 15px auto;
      max-width: var(--container-max);
    }
    #options label {
      font-size: 1.02rem;
      line-height: 1.2;
      display: block;
      margin-bottom: 6px;
      cursor: pointer;
    }
    #preview {
      width: 90vw;
      max-width: var(--container-max);
      height: 350px;
      border: 1px solid #ccc;
      background-color: #fff;
      margin-top: 25px;
    }
    input[type="file"] { display: none; }

    .gray-btn, .blue-btn {
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: transform .05s ease;
    }
    .gray-btn:active, .blue-btn:active { transform: translateY(1px); }

    .gray-btn {
      margin-top: 15px;
      background-color: #ccc;
      color: #333;
      padding: 8px 12px;
      font-size: 1rem;
    }
    .gray-btn:hover { background-color: #bbb; }

    .blue-btn {
      margin-top: 20px;
      background-color: #007BFF;
      color: white;
      padding: 8px 25px;
      font-size: 1.1rem;
    }
    .blue-btn:hover { background-color: #0056b3; }

    /* ì¶”ê°€ */
.blue-btn[disabled] {
  opacity: .6;
  cursor: not-allowed;
  filter: grayscale(0.2);
}
    #result {
      margin-top: 16px;
      font-size: 0.98rem;
      color: #333;
      min-height: 1.2em;
    }

    /* ìƒë‹¨ í•œ/ì˜ í† ê¸€ ë°°ì§€ */
    .lang-badge {
      position: fixed;
      top: 12px;
      right: 12px;
      background: #111;
      color: #fff;
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 0.9rem;
      border: 1px solid rgba(255,255,255,0.25);
      cursor: pointer;
      user-select: none;
      line-height: 1;
    }
    .lang-badge:hover { opacity: .9; }

    .email-wrap {
      text-align: center;
      max-width: var(--container-max);
      margin: 0 auto;
    }
    .email-input {
      width: 100%;
      height: 36px;
      font-size: 1rem;
      padding: 6px 10px;
      margin: 4px auto 8px auto;
      border: 1px solid #ccc;
      border-radius: 0;
      box-sizing: border-box;
    }
    .email-help {
      margin: 3px 0 4px 0;
      font-size: 0.85rem;
      color: #333;
    }
  </style>
</head>
<body>
  <!-- ìƒë‹¨ ì–¸ì–´ í† ê¸€ -->
  <button id="langToggle" class="lang-badge" aria-label="Switch language">ENG</button>

  <h2 id="titleBlock">
    â€˜í•¨ê»˜ ë””ìì¸í•˜ëŠ” í¬ìš©: ì‹¤ì²œì„ í†µí•œ ë³€í™”â€™<br/>ë‚´ê°€ í¬ìš©í•  ìˆ˜ ìˆëŠ” ì‹¤ì²œ ëª©í‘œ ì •í•˜ê¸°
  </h2>

  <div id="options"></div>

  <!-- ìˆ¨ê¸´ íŒŒì¼ ì„ íƒ input -->
  <input type="file" accept="image/*" id="inputImage" />

  <!-- ì‚¬ìš©ì ì¹œí™”ì  ë²„íŠ¼ -->
  <button class="gray-btn" id="customButton">ğŸ“· ì‹¤ì²œ ëª©í‘œ ì‚¬ì§„ ì„ íƒ</button>
  <br />
  <canvas id="preview" width="300" height="350" aria-label="Preview canvas"></canvas>
  <br />

  <div class="email-wrap">
    <input id="userEmail" type="email" class="email-input" placeholder="ì´ë©”ì¼ ì£¼ì†Œ (ì„ íƒì‚¬í•­)" />
    <p id="emailHelp" class="email-help">
      ì´ë©”ì¼ì„ ì‘ì„±í•´ì£¼ì‹œë©´, ì´ë©”ì¼ë¡œ ì°¸ì—¬í•˜ì‹  ì‚¬ì§„ì„ ë³´ë‚´ë“œë¦½ë‹ˆë‹¤.
    </p>
  </div>

  <button class="blue-btn" id="submitBtn">ì°¸ì—¬í•˜ê¸°</button>
  <p id="result"></p>

<script>
  /**************
   * i18n ì‚¬ì „ *
   **************/
  const i18n = {
    ko: {
      htmlLang: "ko",
      docTitle: "ì‹¤ì²œ ëª©í‘œ ì •í•˜ê¸°",
      title1: "â€˜í•¨ê»˜ ë””ìì¸í•˜ëŠ” í¬ìš©: ì‹¤ì²œì„ í†µí•œ ë³€í™”â€™",
      title2: "ë‚´ê°€ í¬ìš©í•  ìˆ˜ ìˆëŠ” ì‹¤ì²œ ëª©í‘œ ì •í•˜ê¸°",
      choosePhoto: "ğŸ“· ì‹¤ì²œ ëª©í‘œ ì‚¬ì§„ ì„ íƒ",
      submit: "ì°¸ì—¬í•˜ê¸°",
      emailPlaceholder: "ì´ë©”ì¼ ì£¼ì†Œ (ì„ íƒì‚¬í•­)",
      emailHelp: "ì´ë©”ì¼ë¡œ ì°¸ì—¬í•˜ì‹  ì‚¬ì§„ì„ ë³´ë‚´ë“œë¦½ë‹ˆë‹¤.",
      alerts: {
        noGoal: "ì‹¤ì²œëª©í‘œë¥¼ ì„ íƒí•˜ì„¸ìš”.",
        noPhoto: "ì‚¬ì§„ì„ ì„ íƒí•˜ì„¸ìš”."
      },
      status: {
        heicConverting: "ğŸ”„ HEIC ë³€í™˜ ì¤‘...",
        heicError: "âŒ HEIC ë³€í™˜ ì˜¤ë¥˜: ",
        uploading: "â³ ì—…ë¡œë“œ ì¤‘...",
        uploadSuccess: "<b style='color:blue;'>âœ… ì—…ë¡œë“œ ì™„ë£Œ!</b><br><b style='color:red;'>ì—…ë¡œë“œëœ ì‚¬ì§„ì´ 1ë¶„ í›„ì— í™”ë©´ì— ë‚˜íƒ€ë‚©ë‹ˆë‹¤.<br>ì ì‹œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”.</b>",
        uploadFail: "âŒ ì—…ë¡œë“œ ì‹¤íŒ¨: ",
        error: "âŒ ì˜¤ë¥˜ ë°œìƒ: "
      },
      toggleLabel: "ENG", // í˜„ì¬ í•œêµ­ì–´ì¼ ë•Œ ë³´ì—¬ì¤„ ë²„íŠ¼ í…ìŠ¤íŠ¸(=ë°”ê¿€ ëŒ€ìƒ)
      toggleAria: "Switch to English"
    },
    en: {
      htmlLang: "en",
      docTitle: "Choose a Practice Goal",
      title1: "â€œDesigning Inclusion Together: Change Through Practiceâ€",
      title2: "Set Your Inclusion Practice Goal",
      choosePhoto: "ğŸ“· Select Practice Goal Photo",
      submit: "Submit",
      emailPlaceholder: "Email address (optional)",
      emailHelp: "If you provide your email address, weâ€™ll email you the photo you participated with.",
      alerts: {
        noGoal: "Please select a goal.",
        noPhoto: "Please choose a photo."
      },
      status: {
        heicConverting: "ğŸ”„ Converting HEIC...",
        heicError: "âŒ HEIC conversion error: ",
        uploading: "â³ Uploading...",
        uploadSuccess: "<b style='color:blue;'>âœ… Upload complete!</b><br><b style='color:red;'>Your uploaded photo will appear on the screen after 1 minute.<br>Please wait.</b>",
        uploadFail: "âŒ Upload failed: ",
        error: "âŒ Error: "
      },
      toggleLabel: "í•œê¸€", // í˜„ì¬ ì˜ì–´ì¼ ë•Œ ë³´ì—¬ì¤„ ë²„íŠ¼ í…ìŠ¤íŠ¸
      toggleAria: "í•œêµ­ì–´ë¡œ ì „í™˜"
    }
  };

  /************************
   * ëª©í‘œ(ë¼ë””ì˜¤) ì •ì˜í‘œ  *
   ************************/
  const GOALS = [
    { id: "b", ko: "ì“°ì„ì„ ì°¾ì•„ ê³„ì† ì‚¬ìš©í•˜ê¸°",    en: "Find new purposes and continue their use" },
    { id: "e", ko: "ì„±ì¥í•˜ëŠ” ëŒ€ìƒ ë³´ì‚´í”¼ê¸°",        en: "Care for things that grow" },
    { id: "g", ko: "ìµìˆ™í•¨ ê·¹ë³µí•˜ê¸°",              en: "Venture beyond the familiar" },
    { id: "h", ko: "ì§€ì†ê°€ëŠ¥ ê³µë™ì²´ ë§Œë“¤ê¸°",        en: "Build sustainable communities" },
    { id: "i", ko: "ì¸ê°„ì˜ ë³´í¸ì„± ì¸ì‹í•˜ê¸°",        en: "Recognize human universality" },
    { id: "c", ko: "ë‚˜ì—ê²Œ ë§ê²Œ ë°”ê¾¸ì–´ ë³´ê¸°",        en: "Adapt and modify to suit yourself" },
    { id: "a", ko: "ë²„ë ¤ì§„ ê²ƒì˜ ì•„ë¦„ë‹¤ì›€ ë°œê²¬í•˜ê¸°",  en: "Find beauty in the discarded" },
    { id: "d", ko: "ì‹ ì²´ì  ì°¨ì´ ë°°ë ¤í•˜ê¸°",          en: "Consider physical differences" },
    { id: "f", ko: "ê¸°ìˆ ì— ë”°ë¥¸ í–‰ë™ë³€í™” ì´í•´í•˜ê¸°",  en: "Understand behavioral changes driven by technology" }
  ];
  const TOP_BAR_FONT = {
  ko: { size: 18, lineHeight: 22 },
  en: { size: 16, lineHeight: 22 } // ì˜ì–´ëŠ” í•­ìƒ ê°™ì€ í¬ê¸°(í†µì¼)
};

  /********************
   * IDë³„ ì•„ì´ì½˜/ìƒ‰ìƒ *
   ********************/
  const ICONS = {
    a: "./icons/a.png",
    b: "./icons/b.png",
    c: "./icons/c.png",
    d: "./icons/d.png",
    e: "./icons/e.png",
    f: "./icons/f.png",
    g: "./icons/g.png",
    h: "./icons/h.png",
    i: "./icons/i.png",
  };
  const COLORS = {
    a: "#ED40C4",
    b: "#00A400",
    c: "#FFD700",
    d: "#22E7AD",
    e: "#7E22C6",
    f: "#2257F3",
    g: "#FF8700",
    h: "#E00000",
    i: "#00C3FF"
  };

  const iconCache = {};
  function loadIconById(id) {
    return new Promise((resolve, reject) => {
      if (!id || !ICONS[id]) return resolve(null);
      if (iconCache[id] && iconCache[id].complete) return resolve(iconCache[id]);
      const img = new Image();
      img.crossOrigin = "anonymous";
      img.onload = () => { iconCache[id] = img; resolve(img); };
      img.onerror = reject;
      img.src = ICONS[id];
    });
  }

  /**************
   * DOM í•¸ë“¤ëŸ¬ *
   **************/
  const input     = document.getElementById('inputImage');
  const canvas    = document.getElementById('preview');
  const ctx       = canvas.getContext('2d');

  const langBtn   = document.getElementById('langToggle');
  const titleEl   = document.getElementById('titleBlock');
  const optionsEl = document.getElementById('options');
  const chooseBtn = document.getElementById('customButton');
  const emailEl   = document.getElementById('userEmail');
  const emailHelp = document.getElementById('emailHelp');
  const submitBtn = document.getElementById('submitBtn');
  const resultEl  = document.getElementById('result');

  let imageDataUrl = null;
  let originalImageUrl = null;

  let isUploading = false;

// ì—…ë¡œë“œ ì¤‘ UI ì ê·¸ê¸°/í’€ê¸°
function setUIBusy(busy) {
  isUploading = busy;

  // ì œì¶œ ë²„íŠ¼
  submitBtn.disabled = busy;
  submitBtn.setAttribute('aria-busy', busy ? 'true' : 'false');
  submitBtn.setAttribute('aria-disabled', busy ? 'true' : 'false');
  submitBtn.textContent = busy ? t('status.uploading') : i18n[lang].submit;

  // ë‹¤ë¥¸ ì…ë ¥ë“¤ë„ ì ê¸ˆ(ì„ íƒ)
  chooseBtn.disabled = busy;
  input.disabled = busy;
  emailEl.disabled = busy;
  optionsEl.querySelectorAll('input[name="textOption"]').forEach(r => r.disabled = busy);
}

  // í˜„ì¬ ì–¸ì–´ (localStorage ìš°ì„ )
  let lang = localStorage.getItem('lang') || 'ko';

  function t(path) {
    const segs = path.split('.');
    let cur = i18n[lang];
    for (const s of segs) cur = cur?.[s];
    return cur ?? '';
  }

  async function setLanguage(newLang) {
    lang = newLang;
    localStorage.setItem('lang', lang);

    // <html lang="">
    document.documentElement.lang = i18n[lang].htmlLang || lang;

    // <title>
    document.title = i18n[lang].docTitle;

    // ìƒë‹¨ ì œëª©
    titleEl.innerHTML = `${i18n[lang].title1}<br/>${i18n[lang].title2}`;

    // ë²„íŠ¼/placeholder
    chooseBtn.textContent = i18n[lang].choosePhoto;

    submitBtn.textContent = isUploading ? t('status.uploading') : i18n[lang].submit;
    emailEl.placeholder = i18n[lang].emailPlaceholder;
    emailHelp.textContent = i18n[lang].emailHelp;

    // ì–¸ì–´ í† ê¸€ ë±ƒì§€
    langBtn.textContent = i18n[lang].toggleLabel;
    langBtn.setAttribute('aria-label', i18n[lang].toggleAria);

    // ì˜µì…˜ ì¬ë Œë” (ì„ íƒ ìœ ì§€)
    const prevSelectedId = getSelectedGoalId();
    renderOptions(prevSelectedId);

    // ìº”ë²„ìŠ¤ ì–¸ì–´ ë°˜ì˜ ì¬ê·¸ë¦¬ê¸°
    if (originalImageUrl && prevSelectedId) {
     await renderCanvas(originalImageUrl, prevSelectedId);
     imageDataUrl = canvas.toDataURL("image/png");
   }
  }

  function getSelectedGoalId() {
    const checked = optionsEl.querySelector('input[name="textOption"]:checked');
    return checked ? checked.dataset.id : null;
  }
  function getGoalLabelById(id) {
    const item = GOALS.find(g => g.id === id);
    return item ? item[lang] : '';
  }

  function renderOptions(selectedId = null) {
    const html = GOALS.map(g => {
      const label = g[lang];
      const checked = g.id === selectedId ? 'checked' : '';
      // data-idëŠ” ê³ ì •, valueëŠ” í˜„ì¬ ì–¸ì–´ ë¼ë²¨
      return `
        <label>
          <input type="radio" name="textOption" value="${label}" data-id="${g.id}" ${checked} />
          ${label}
        </label>`;
    }).join('');
    optionsEl.innerHTML = html;

    // ë¼ë””ì˜¤ ì´ë²¤íŠ¸
    optionsEl.querySelectorAll('input[name="textOption"]').forEach(radio => {
      radio.addEventListener('change', async () => {
        if (!originalImageUrl) return;
        const sid = radio.dataset.id;
        await renderCanvas(originalImageUrl, sid);
        imageDataUrl = canvas.toDataURL("image/png");
      });
    });
  }

  // í•œ/ì˜ í† ê¸€ í´ë¦­
  langBtn.addEventListener('click', async () => {
   await setLanguage(lang === 'ko' ? 'en' : 'ko');
 });

  // ì‚¬ì§„ì„ íƒ ë²„íŠ¼ -> íŒŒì¼ ì…ë ¥ ì—´ê¸°
  document.getElementById("customButton").addEventListener("click", () => {
    input.click();
  });

  // íŒŒì¼ ì„ íƒ ì²˜ë¦¬ + HEIC ë³€í™˜
  input.addEventListener('change', async e => {
    const file = e.target.files[0];
    if (!file) return;

    let blob = file;

    if (file.type === 'image/heic' || file.type === 'image/heif' || /\.heic$/i.test(file.name)) {
      try {
        resultEl.innerText = t('status.heicConverting');
        blob = await heic2any({ blob: file, toType: 'image/jpeg', quality: 0.9 });
      } catch (err) {
        resultEl.innerText = t('status.heicError') + err.message;
        return;
      }
    }

    const reader = new FileReader();
    reader.onload = async () => {
      originalImageUrl = reader.result;

      // í˜„ì¬ ì„ íƒ ê°€ì ¸ì™€ì„œ ê·¸ë¦¼
      const sid = getSelectedGoalId();
      await renderCanvas(originalImageUrl, sid);
      imageDataUrl = canvas.toDataURL("image/png");
      resultEl.innerText = "";
    };
    reader.readAsDataURL(blob);
  });

  // ìº”ë²„ìŠ¤ ê·¸ë¦¬ê¸°
  async function renderCanvas(originalUrl, selectedId) {
    const baseImg = await loadBaseImage(originalUrl);
    const iconImg = selectedId ? await loadIconById(selectedId) : null;

    // ì •ì‚¬ê°í˜• í¬ë¡­
    const side = Math.min(baseImg.width, baseImg.height);
    const sx = (baseImg.width - side) / 2;
    const sy = (baseImg.height - side) / 2;

    canvas.width = 300;
    canvas.height = 350;
    ctx.clearRect(0, 0, 300, 350);

    // ì‚¬ì§„ ë³¸ë¬¸
    ctx.drawImage(baseImg, sx, sy, side, side, 0, 50, 300, 300);

    // ìƒë‹¨ ë°” ìƒ‰ìƒ (ì„ íƒ ì—†ìœ¼ë©´ íšŒìƒ‰)
    const barColor = selectedId ? (COLORS[selectedId] || "#939393") : "#939393";
    ctx.fillStyle = barColor;
    ctx.fillRect(0, 0, 300, 50);

    // ìš°ì¸¡ í…ìŠ¤íŠ¸
if (selectedId) {
  const label = getGoalLabelById(selectedId);
  // ì˜¤ë¥¸ìª½ ì—¬ë°± ê°ì•ˆ: xRight=290, yCenter=25, í…ìŠ¤íŠ¸ ì˜ì—­ maxWidth=220
  drawTopBarText(label, 290, 25, 240);
}


    // ì¢Œì¸¡ ì•„ì´ì½˜
    if (iconImg && selectedId) {
      const pad = 0;
      const iconSize = 50;
      const x = pad, y = pad;
      ctx.drawImage(iconImg, x, y, iconSize, iconSize);
    }
  }

  // í…ìŠ¤íŠ¸ê°€ ê¸¸ë©´ í°íŠ¸ í¬ê¸° ì¤„ì´ê±°ë‚˜ ... ì²˜ë¦¬
 // ì£¼ì–´ì§„ ìµœëŒ€ ë„ˆë¹„ ì•ˆì—ì„œ ìµœëŒ€ 2ì¤„ë¡œ ì¤„ë°”ê¿ˆ(ë‘ ë²ˆì§¸ ì¤„ì€ í•„ìš” ì‹œ â€¦ ì²˜ë¦¬)
function wrapToTwoLines(text, maxWidth) {
  const lines = [];

  // ì˜ì–´ëŠ” ê³µë°± ë‹¨ìœ„ë¡œ, í•œê¸€/ì¤‘ë¬¸ ë“±ì€ ê¸€ì ë‹¨ìœ„ë¡œ ê·¸ë¦¬ë”” ë¶„í• 
  const isEnglish = /^[\x00-\x7F]+$/.test(text.replace(/\s/g, ''));
  if (isEnglish) {
    const words = text.trim().split(/\s+/);
    let line = '';
    for (const w of words) {
      const test = line ? line + ' ' + w : w;
      if (ctx.measureText(test).width <= maxWidth) {
        line = test;
      } else {
        lines.push(line);
        line = w;
        if (lines.length === 2) break;
      }
    }
    if (lines.length < 2 && line) lines.push(line);
  } else {
    let line = '';
    for (const ch of [...text.trim()]) {
      const test = line + ch;
      if (ctx.measureText(test).width <= maxWidth) {
        line = test;
      } else {
        lines.push(line);
        line = ch;
        if (lines.length === 2) break;
      }
    }
    if (lines.length < 2 && line) lines.push(line);
  }

  // ë‘ ì¤„ ë„˜ì–´ê°€ë©´ ë‘ ë²ˆì§¸ ì¤„ì„ ë§ì¤„ì„
 /* if (lines.length > 2) lines.length = 2;
  if (lines.length === 2) {
    let l2 = lines[1];
    while (l2.length && ctx.measureText(l2 + 'â€¦').width > maxWidth) {
      l2 = l2.slice(0, -1);
    }
    lines[1] = l2 + (l2.endsWith('â€¦') ? '' : 'â€¦');
  }*/

  return lines;
}

// ìƒë‹¨ ë°” ì˜¤ë¥¸ìª½ ì •ë ¬ë¡œ 1~2ì¤„ ê·¸ë¦¬ê¸°(ì–¸ì–´ë³„ ê³ ì • í°íŠ¸/ì¤„ê°„ê²©)
function drawTopBarText(label, xRight, yCenter, maxWidth) {
  const { size, lineHeight } = TOP_BAR_FONT[lang] || TOP_BAR_FONT.en;
  ctx.font = `bold ${size}px sans-serif`;
  ctx.fillStyle = "rgba(255,255,255,0.95)";
  ctx.textAlign = "right";
  ctx.textBaseline = "middle";

  const lines = wrapToTwoLines(label, maxWidth);
  const totalH = lines.length * lineHeight;
  const startY = yCenter - (totalH - lineHeight) / 2;

  lines.forEach((ln, i) => {
    ctx.fillText(ln, xRight, startY + i * lineHeight);
  });
}


  function loadBaseImage(src) {
    return new Promise((resolve, reject) => {
      const img = new Image();
      img.crossOrigin = "anonymous";
      img.onload = () => resolve(img);
      img.onerror = reject;
      img.src = src;
    });
  }

  // ì—…ë¡œë“œ
  function upload() {
     if (isUploading) return;

  const selectedRadio = optionsEl.querySelector('input[name="textOption"]:checked');
  if (!selectedRadio) { alert(t('alerts.noGoal')); return; }
  const selectedId = selectedRadio.dataset.id;
  const selectedLabel = getGoalLabelById(selectedId);

  if (!imageDataUrl) { alert(t('alerts.noPhoto')); return; }

  // === ì ê¸ˆ ì‹œì‘ ===
  setUIBusy(true);
    resultEl.innerText = t('status.uploading');

    const form = new FormData();
    form.append("image", imageDataUrl);
    form.append("goal", selectedLabel);     // í˜„ì¬ í™”ë©´ ì–¸ì–´ì˜ ë¼ë²¨
    form.append("goalId", selectedId);      // ê³ ì • ID (a~i)
    form.append("email", (document.getElementById("userEmail").value || "").trim());
    const uiLang = (lang === 'en') ? 'en' : 'ko';
    form.append("lang", uiLang);

   fetch("https://script.google.com/macros/s/AKfycbyrvmD7actnvnGdPbCob22HCFEdiUKJZmyUQVtxYS6Zz6G4uDFKIzJGec-9xO7yiCI0/exec", {
  method: "POST",
  body: form
})
.then(res => res.text())
.then(res => {
  if (res.includes("SUCCESS")) {
    resultEl.innerHTML = t('status.uploadSuccess'); // HTML ìœ ì§€
  } else {
    resultEl.innerText = t('status.uploadFail') + res;
  }
})
.catch(err => {
  resultEl.innerText = t('status.error') + err.message;
})
.finally(() => {
  setUIBusy(false); // ì—…ë¡œë“œ UI ì ê¸ˆ í•´ì œ
});
  }

  document.getElementById("submitBtn").addEventListener("click", upload);

  // ì´ˆê¸° ì„¸íŒ…
  renderOptions(null);
  setLanguage(lang);
</script>
</body>
</html>
